package com.ski.box.view.fragment.bet.bottom;import android.content.Context;import android.content.DialogInterface;import android.view.View;import android.widget.TextView;import androidx.annotation.NonNull;import com.hwangjr.rxbus.RxBus;import com.ski.box.ConstantValue;import com.ski.box.bean.AlertConfigurationBean;import com.ski.box.bean.DataCenter;import com.ski.box.bean.MkBetParamEntity;import com.ski.box.view.view.BettingConfirmViewFuShi;import com.ski.box.view.view.dialog.LotteryDialog;import com.ski.box.view.view.dialog.StrongBottomSheetDialog;import com.yb.core.utils.LanguageUtil;import com.yb.core.utils.ToastUtil;import java.util.List;import static com.ski.box.ConstantValue.EVENT_REQUEST_BET_SUBMIT;public class BetFuShiDialog extends StrongBottomSheetDialog {    private long mLastClickTime;    private long mTimeInterval = 1000L;    private boolean mShowRemind=true;    private BettingConfirmViewFuShi bettingConfirmViewFuShi;    public BetFuShiDialog(@NonNull Context context) {        super(context);        createView(context);        /**弹框出现时,设置最新的奖期号码**/        DataCenter.getInstance().getBetParamEntity().setPlanNo(DataCenter.getInstance().getPlanId());        setOnDismissListener(new DialogInterface.OnDismissListener() {            @Override            public void onDismiss(DialogInterface dialog) {                if (mShowRemind) {                    List<MkBetParamEntity.BetParamEntity> bet = DataCenter.getInstance().getBetParamEntity().getBet();                    boolean resetAmount = false;                    for (int x = 0; x < bet.size(); x++) {                        long betAmount_d = bet.get(x).getBetAmount_d();                        if (betAmount_d != DataCenter.getInstance().getQuickMoney()) {                            resetAmount = true;                            bet.get(x).setBetAmount_d(DataCenter.getInstance().getQuickMoney());                        }                    }                    if (resetAmount) {                        //new LotteryDialog().showCenterRemind(context, "金额统一调整为" + DataCenter.getInstance().getQuickMoney());                        // ToastUtil.showInfo("金额统一调整为");                    }                }            }        });    }    private void createView(Context context) {         bettingConfirmViewFuShi = new BettingConfirmViewFuShi(context);       setContentView(bettingConfirmViewFuShi);        List<MkBetParamEntity.BetParamEntity> bet = DataCenter.getInstance().getBetParamEntity().getBet();        bettingConfirmViewFuShi.configurationData(bet);        bettingConfirmViewFuShi.addOnConfirmBet(new BettingConfirmViewFuShi.OnConfirmBetListner() {            @Override            public void confirmBet(View view) {                /*判读奖期是否变更*/                String planId = DataCenter.getInstance().getPlanId();                /*双面盘投注*/                MkBetParamEntity betParamEntity = DataCenter.getInstance().getBetParamEntity();                String planNo = betParamEntity.getPlanNo();                if (!planId.equals(planNo)) {                    /*弹框提醒*/                    /*奖期变更*/                    long nowTime = System.currentTimeMillis();                    if (nowTime - mLastClickTime < mTimeInterval) {                        // 快速点击事件                        return;                    }                    mLastClickTime = nowTime;                    showPeroidChangeDailog(view,planId);                }else{                    /*双面盘投注*/                    betParamEntity.setFrom(ConstantValue.BET_FROM_BET_RIGHT_NOW);                    betParamEntity.setBetView(view);                    RxBus.get().post(EVENT_REQUEST_BET_SUBMIT, betParamEntity);                }            }            @Override            public void closeBetConfrimDaiglog() {                dismiss();            }        });    }    private void showPeroidChangeDailog(View view, String planId) {        String ticketName = DataCenter.getInstance().getCurLotteryName();        String s1 = LanguageUtil.getText("，期数变化")                + "\n"                + LanguageUtil.getText("当前已进入");        String s2 = LanguageUtil.getText("期");        String s3 = "放弃投注";        String s4 = "继续投注";        String s = ticketName + s1 + planId + s2;        AlertConfigurationBean bean = new AlertConfigurationBean();        bean.setContent(s);        bean.setLeftButtonText(s3);        bean.setRightButtonText(s4);        new LotteryDialog().showAlertDialog(getContext(), bean, new LotteryDialog.OnSelectAlertDialogCallBack() {            @Override            public void rightButton() {                MkBetParamEntity betParamEntity = DataCenter.getInstance().getBetParamEntity();                betParamEntity.setPlanNo(planId);                /*双面盘投注*/                betParamEntity.setFrom(ConstantValue.BET_FROM_BET_RIGHT_NOW);                betParamEntity.setBetView(view);                RxBus.get().post(EVENT_REQUEST_BET_SUBMIT, betParamEntity);            }            @Override            public void leftButton() {            }        });    }    public void onDismiss(boolean showRemind) {        mShowRemind = showRemind;        dismiss();    }    public TextView getBetView() {       return bettingConfirmViewFuShi.mBetConfirm;    }}